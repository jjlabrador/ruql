<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Example quiz</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <!-- -->
    <style type="text/css" media="all">
      div.quiz, p.comment, div.explanation {display:inline;}
      strong.correct {color:#14B63F;}
      strong.incorrect {color:rgb(255,0,0);}
      strong.mark {color:rgb(255,128,0);}
      div.score {font-weight: bold; font-size: 20px;}
      input.correct {color:#14B63F; font-weight: bold;}
      input.incorrect {color:rgb(255,0,0); font-weight: bold;}
      div.custom-header {background-color:#7a3b7a; color:#FFFFFF; font-weight: bold;}
      body {padding-top: 20px; padding-bottom: 20px; margin-bottom: 20px;}
      html {position: relative; min-height: 100%;}
      .navbar {margin-bottom: 20px;}
      .btn-footer {text-align: center;}
      #footer {
        position: absolute;
        bottom: 0;
        height: 30px;
        width: inherit;
      }
      div.container {background-color:#EAEAEA;}
      div.explanation {font-style: italic;}
      .nav>li>a.links {
        display: inline; 
        padding: 0; 
        color: #FFFFFF;
      }
      .nav>li>a.links:hover {color: #FFCCFF;}
      /* Inputs size */
      input.size-4 { width: 2.8em; }

input.size-5 { width: 3.5em; }

input.size-8 { width: 5.6em; }
div.size-3 { width: 2.1em; display: inline; }

    </style>
    <!-- Any CSS included by the user -->
    
    <!-- Mathjax -->
    
        <script type=text/javascript src=http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML></script>
        <script type=text/javascript>
          MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
        </script>
      
    <!--         -->
  </head>
  <body>
    <div class="container">
      
        <div class="navbar navbar-default custom-header">
          <div class="navbar-header">
            <h3>Example quiz</h3>
          </div>
          <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
              <li>Asignatura: TFG</li><br/>
              <li>Curso: 4º</li><br/>
              <li>
                <a href="http://www.ull.es/view/centros/etsii/Inicio/es" class="links">
                  Escuela T&eacute;cnica Superior de Ingenier&iacute;a Inform&aacute;tica</a>
                |
                <a href="http://www.ull.es/" class="links">Universidad de la Laguna</a>
              </li>
            </ul>
          </div>
        </div>
      
      <!-- Seed: 331547326527885758825382798102671443547 -->
<form id="form">
  <ol class="questions">
    <li id="question-0" class="question fillin ">
      <div class="quiz text">
[1 point] <i>Example of escaped HTML and three hyphens not evaluated:</i><br> &lt;a href=&quot;www.google.es&quot;&gt;&lt;/a&gt; <b>is</b> a --- <input type=text id=qfi1-1 class='fillin size-4'></input> ---<div id=qfi1-1r class=quiz></div></br></br>      </div>
      <button type="button" id="show-answer-q-0" class="btn btn-success btn-sm">
Mostrar respuesta      </button>
      <button type="button" id="q-0" class="btn btn-primary btn-sm">
Enviar      </button>
      <br>
      </br>
    </li>
    <li id="question-1" class="question fillin ">
      <div class="quiz text">
[2 points] The visionary founder of Apple is <input type=text id=qfi2-1 class='fillin size-8'></input><div id=qfi2-1r class=quiz></div></br></br>      </div>
      <p class="comment">
Question too easy<br></br>      </p>
      <button type="button" id="show-answer-q-1" class="btn btn-success btn-sm">
Mostrar respuesta      </button>
      <button type="button" id="q-1" class="btn btn-primary btn-sm">
Enviar      </button>
      <br>
      </br>
    </li>
    <li id="question-2" class="question fillin ">
      <div class="quiz text">
[1 point] The <input type=text id=qfi3-1 class='fillin size-4'></input> brown fox jumped over the lazy <input type=text id=qfi3-2 class='fillin size-4'></input><div id=qfi3-2r class=quiz></div></br></br>      </div>
      <button type="button" id="show-answer-q-2" class="btn btn-success btn-sm">
Mostrar respuesta      </button>
      <button type="button" id="q-2" class="btn btn-primary btn-sm">
Enviar      </button>
      <br>
      </br>
    </li>
    <li id="question-3" class="question dragdrop ">
      <div class="quiz text">
[1 point] The <input id=qdd4-1 class='dragdrop size-4' ondrop=drop(event,'qdd4-1') ondragover=allowDrop(event)></input> brown fox jumped over the lazy <input id=qdd4-2 class='dragdrop size-4' ondrop=drop(event,'qdd4-2') ondragover=allowDrop(event)></input><br/><br/><div> Respuestas: <button class='dragdrop size-3 btn btn-default btn-sm' id=qdda1-1 draggable=true ondragstart=drag(event)>fox</button>&nbsp&nbsp<button class='dragdrop size-3 btn btn-default btn-sm' id=qdda2-2 draggable=true ondragstart=drag(event)>dog</button>&nbsp&nbsp<div/></br></br>      </div>
      <button type="button" id="q-3" class="btn btn-primary btn-sm">
Enviar      </button>
      <br>
      </br>
    </li>
    <li id="question-4" class="question fillin ">
      <div class="quiz text">
[1 point] The three stooges are <input type=text id=qfi5-1 class='fillin size-5'></input>, <input type=text id=qfi5-2 class='fillin size-4'></input>, and <input type=text id=qfi5-3 class='fillin size-5'></input>.<div id=qfi5-3r class=quiz></div></br></br>      </div>
      <button type="button" id="show-answer-q-4" class="btn btn-success btn-sm">
Mostrar respuesta      </button>
      <button type="button" id="q-4" class="btn btn-primary btn-sm">
Enviar      </button>
      <br>
      </br>
    </li>
    <li id="question-5" class="question fillin ">
      <div class="quiz text">
[1 point] The three stooges are <input type=text id=qfi6-1 class='fillin size-5'></input>, <input type=text id=qfi6-2 class='fillin size-4'></input>, and <input type=text id=qfi6-3 class='fillin size-5'></input>.<div id=qfi6-3r class=quiz></div></br></br>      </div>
      <button type="button" id="show-answer-q-5" class="btn btn-success btn-sm">
Mostrar respuesta      </button>
      <button type="button" id="q-5" class="btn btn-primary btn-sm">
Enviar      </button>
      <br>
      </br>
    </li>
    <li id="question-6" class="question fillin ">
      <div class="quiz text">
[1 point] The capital of Tenerife is <input type=text id=qfi7-1 class='fillin size-5'></input> Cruz de <input type=text id=qfi7-2 class='fillin size-8'></input><div id=qfi7-2r class=quiz></div></br></br>      </div>
      <button type="button" id="show-answer-q-6" class="btn btn-success btn-sm">
Mostrar respuesta      </button>
      <button type="button" id="q-6" class="btn btn-primary btn-sm">
Enviar      </button>
      <br>
      </br>
    </li>
    <li id="question-7" class="question fillin ">
      <div class="quiz text">
[1 point] 
      Diga dos números x = <input type=text id=qfi8-1 class='fillin size-4'></input> e  y = <input type=text id=qfi8-2 class='fillin size-4'></input> que multiplicados den 100
    <div id=qfi8-2r class=quiz></div></br></br>      </div>
      <button type="button" id="q-7" class="btn btn-primary btn-sm">
Enviar      </button>
      <br>
      </br>
    </li>
    <li id="question-8" class="question fillin ">
      <div class="quiz text">
[1 point] 
      Calculate the determinant of this matrix:
      $$\mathbf{A} = \begin{vmatrix} 
      1 & 3 \\ 
      2 & 4 
      \end{vmatrix}$$
      <br/>
      <input type=text id=qfi9-1 class='fillin size-4'></input>
    <div id=qfi9-1r class=quiz></div></br></br>      </div>
      <button type="button" id="show-answer-q-8" class="btn btn-success btn-sm">
Mostrar respuesta      </button>
      <button type="button" id="q-8" class="btn btn-primary btn-sm">
Enviar      </button>
      <br>
      </br>
    </li>
    <li id="question-9" class="question fillin ">
      <div class="quiz text">
[1 point] 
      Solve: 
      $$\binom{n}{k} = \frac{n!}{k!(n-k)!}$$
      when n = 5 and k = 2:
      <input type=text id=qfi10-1 class='fillin size-4'></input>
    <div id=qfi10-1r class=quiz></div></br></br>      </div>
      <button type="button" id="show-answer-q-9" class="btn btn-success btn-sm">
Mostrar respuesta      </button>
      <button type="button" id="q-9" class="btn btn-primary btn-sm">
Enviar      </button>
      <br>
      </br>
    </li>
    <li id="question-10" class="question fillin ">
      <div class="quiz text">
[1 point] 
      When x = 2, the solution of $\sqrt{3x+3}+(1+x)^2$ is:
      <input type=text id=qfi11-1 class='fillin size-4'></input>
    <div id=qfi11-1r class=quiz></div></br></br>      </div>
      <button type="button" id="show-answer-q-10" class="btn btn-success btn-sm">
Mostrar respuesta      </button>
      <button type="button" id="q-10" class="btn btn-primary btn-sm">
Enviar      </button>
      <br>
      </br>
    </li>
    <li id="question-11" class="question multiplechoice ">
      <div class="quiz text">
[1 point] What is the largest US state?<br></br>      </div>
      <ol class="answers">
        <input type="radio" id="qmc12-1" name="qmc12" class="select">
Alaska<br class=qmc12-1br>        </input>
        <div id="qmc12-1r" class="quiz">
        </div>
        <input type="radio" id="qmc12-2" name="qmc12" class="select">
Texas<br class=qmc12-2br>        </input>
        <div id="qmc12-2r" class="quiz">
        </div>
        <input type="radio" id="qmc12-3" name="qmc12" class="select">
Hawaii<br class=qmc12-3br>        </input>
        <div id="qmc12-3r" class="quiz">
        </div>
        <br/>
      </ol>
    </li>
    <button type="button" id="show-answer-q-11" class="btn btn-success btn-sm">
Mostrar respuesta    </button>
    <button type="button" id="q-11" class="btn btn-primary btn-sm">
Enviar    </button>
    <br>
    </br>
    <li id="question-12" class="question selectmultiple multiple">
      <div class="quiz text">
[1 point] Select ALL that apply: Which are American political parties?<br></br>      </div>
      <ol class="answers">
        <input type="checkbox" id="qsm13-1" class="check">
Democrats<br class=qsm13-1br>        </input>
        <div id="qsm13-1r" class="quiz">
        </div>
        <input type="checkbox" id="qsm13-2" class="check">
Republicans<br class=qsm13-2br>        </input>
        <div id="qsm13-2r" class="quiz">
        </div>
        <input type="checkbox" id="qsm13-3" class="check">
Greens<br class=qsm13-3br>        </input>
        <div id="qsm13-3r" class="quiz">
        </div>
        <input type="checkbox" id="qsm13-4" class="check">
Tories<br class=qsm13-4br>        </input>
        <div id="qsm13-4r" class="quiz">
        </div>
        <input type="checkbox" id="qsm13-5" class="check">
Social Democrats<br class=qsm13-5br>        </input>
        <div id="qsm13-5r" class="quiz">
        </div>
        <br/>
      </ol>
    </li>
    <button type="button" id="show-answer-q-12" class="btn btn-success btn-sm">
Mostrar respuesta    </button>
    <button type="button" id="q-12" class="btn btn-primary btn-sm">
Enviar    </button>
    <br>
    </br>
    <li id="question-13" class="question truefalse ">
      <div class="quiz text">
[1 point] True or False: The earth is flat.<br></br>      </div>
      <ol class="answers">
        <input type="radio" id="qmc14-1" name="qmc14" class="select">
True<br class=qmc14-1br>        </input>
        <div id="qmc14-1r" class="quiz">
        </div>
        <input type="radio" id="qmc14-2" name="qmc14" class="select">
False<br class=qmc14-2br>        </input>
        <div id="qmc14-2r" class="quiz">
        </div>
        <br/>
      </ol>
    </li>
    <button type="button" id="show-answer-q-13" class="btn btn-success btn-sm">
Mostrar respuesta    </button>
    <button type="button" id="q-13" class="btn btn-primary btn-sm">
Enviar    </button>
    <br>
    </br>
    <li id="question-14" class="question multiplechoice ">
      <div class="quiz text">
[1 point] What does the following code do:
    <pre>
    puts "Hello world!"
    </pre>
          </div>
      <ol class="answers">
        <input type="radio" id="qmc15-1" name="qmc15" class="select">
Throws an exception<br class=qmc15-1br>        </input>
        <div id="qmc15-1r" class="quiz">
        </div>
        <input type="radio" id="qmc15-2" name="qmc15" class="select">
Prints a friendly message<br class=qmc15-2br>        </input>
        <div id="qmc15-2r" class="quiz">
        </div>
        <br/>
      </ol>
    </li>
    <button type="button" id="show-answer-q-14" class="btn btn-success btn-sm">
Mostrar respuesta    </button>
    <button type="button" id="q-14" class="btn btn-primary btn-sm">
Enviar    </button>
    <br>
    </br>
  </ol>
  <div id="score" class="score">
  </div>
  <div class="btn-footer">
    <button type="button" id="submit" class="btn btn-primary">
Enviar    </button>
    <button type="button" id="reset" class="btn btn-info">
Reset    </button>
    <button type="button" id="deleteAnswers" class="btn btn-warning">
Borrar respuestas    </button>
    <button type="button" id="deleteStorage" class="btn btn-danger">
Borrar almacenamiento    </button>
  </div>
</form>

      
        <div id="footer">
          <div class="row text-muted">
            <div class="col-md-6">
              Quiz generated using the RuQL Gem. For more information, visit <a href="https://github.com/jjlabrador/ruql">GitHub
              <span class="glyphicon glyphicon-link"></span></a>
            </div>
            <div class="col-md-3"></div>
            <div class="col-md-3">
              Universidad de La Laguna 2014
            </div>
          </div>
        </div>
      
    </div>
    <!-- JavaScripts -->
    <!-- jQuery -->
    
        <script type=text/javascript src=http://code.jquery.com/jquery-2.1.0.min.js></script>
        <script type='text/javascript' src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
        <!--[if lt IE 8]>
          <script type=text/javascript src=http://code.jquery.com/jquery-1.11.0.min.js></script>
        <![endif]-->
      
    <!-- Internationalization -->
    <script>      i18n = {"es":{"quiz":{"title":"Cuestionario"},"questions":{"correct":"Correcto","incorrect":"Incorrecto","points":"puntos","score":"Puntuaci&oacute;n total"},"answers":"Respuestas","buttons":{"submit":"Enviar","reset":"Reset","delete":"Borrar respuestas","deleteAll":"Borrar almacenamiento","show":"Mostrar respuesta","hide":"Ocultar respuesta"},"alerts":{"answers":"Respuestas borradas","storage":"Almacenamiento borrado","noStorage":"El navegador no soporta almacenamiento de respuestas"},"exceptions":{"question":"Pregunta","text":"No se ha especificado el texto de la pregunta","answer":"No se ha especificado ninguna respuesta"}}}
</script>
    <!-- Drag and Drop -->
    <script>      function allowDrop(ev) {
        ev.preventDefault();
      }
      
      function drag(ev) {
        ev.dataTransfer.setData("Text",ev.target.id);
      }
      
      function drop(ev, id) {
        ev.preventDefault();
        var data=ev.dataTransfer.getData("Text");
        ev.target.appendChild(document.getElementById(data).cloneNode(true));
        var val=document.getElementById(id);
        val.value=document.getElementById(data).innerText;
      }
</script>
    <!-- XRegexp -->
    <script type=text/javascript src=http://cdnjs.cloudflare.com/ajax/libs/xregexp/2.0.0/xregexp-min.js></script>
    <!-- Form validation -->
    <script>      data = {"question-0":{"question_text":"<i>Example of escaped HTML and three hyphens not evaluated:</i><br> &lt;a href=&quot;www.google.es&quot;&gt;&lt;/a&gt; <b>is</b> a \\-\\-\\- ---- \\-\\-\\-","answers":{"qfi1-1":{"answer_text":"/^link$/","correct":true,"explanation":null,"type":"Regexp"}},"points":1,"order":true,"question_comment":""},"question-1":{"question_text":"The visionary founder of Apple is --------","answers":{"qfi2-1":{"answer_text":"/^ste(ve|phen)\\s+jobs #comment $/ixm","correct":true,"explanation":null,"type":"Regexp"},"qfi2-2":{"answer_text":"/^steve\\s+wozniak/i","correct":false,"explanation":"Almost, but not quite.","type":"Regexp"}},"points":2,"order":true,"question_comment":"Question too easy"},"question-2":{"question_text":"The ---- brown fox jumped over the lazy ----","answers":{"qfi3-1":{"answer_text":"/fox/","correct":true,"explanation":"This sentence contains all of the letters of the English Alphabet","type":"Regexp"},"qfi3-2":{"answer_text":"/dog/","correct":true,"explanation":"This sentence contains all of the letters of the English Alphabet","type":"Regexp"}},"points":1,"order":true,"question_comment":""},"question-3":{"question_text":"The ---- brown fox jumped over the lazy ----","answers":{"qdd4-1":{"answer_text":"fox","correct":true,"explanation":"This sentence contains all of the letters of the English Alphabet","type":"String"},"qdd4-2":{"answer_text":"dog","correct":true,"explanation":"This sentence contains all of the letters of the English Alphabet","type":"String"}},"points":1,"order":true,"question_comment":""},"question-4":{"question_text":"The three stooges are -----, ----, and -----.","answers":{"qfi5-1":{"answer_text":"larry","correct":true,"explanation":null,"type":"String"},"qfi5-2":{"answer_text":"moe","correct":true,"explanation":null,"type":"String"},"qfi5-3":{"answer_text":"curly","correct":true,"explanation":null,"type":"String"}},"points":1,"order":true,"question_comment":""},"question-5":{"question_text":"The three stooges are -----, ----, and -----.","answers":{"qfi6-1":{"answer_text":"larry","correct":true,"explanation":null,"type":"String"},"qfi6-2":{"answer_text":"moe","correct":true,"explanation":null,"type":"String"},"qfi6-3":{"answer_text":"curly","correct":true,"explanation":null,"type":"String"}},"points":1,"order":false,"question_comment":""},"question-6":{"question_text":"The capital of Tenerife is ----- Cruz de --------","answers":{"qfi7-1":{"answer_text":"/Santa/i","correct":true,"explanation":null,"type":"Regexp"},"qfi7-2":{"answer_text":"/Tenerife/i","correct":true,"explanation":null,"type":"Regexp"}},"points":1,"order":true,"question_comment":""},"question-7":{"question_text":"\n      Diga dos números x = ---- e  y = ---- que multiplicados den 100\n    ","answers":{"qfi8-1":{"answer_text":"result = function(x,y) { return (x * y === 100); }","correct":true,"explanation":null,"type":"JS"}},"points":1,"order":true,"question_comment":""},"question-8":{"question_text":"\n      Calculate the determinant of this matrix:\n      $$\\mathbf{A} = \\begin{vmatrix} \n      1 & 3 \\\\ \n      2 & 4 \n      \\end{vmatrix}$$\n      <br/>\n      ----\n    ","answers":{"qfi9-1":{"answer_text":-1,"correct":true,"explanation":null,"type":"Fixnum"}},"points":1,"order":true,"question_comment":""},"question-9":{"question_text":"\n      Solve: \n      $$\\binom{n}{k} = \\frac{n!}{k!(n-k)!}$$\n      when n = 5 and k = 2:\n      ----\n    ","answers":{"qfi10-1":{"answer_text":10,"correct":true,"explanation":null,"type":"Fixnum"},"qfi10-2":{"answer_text":9,"correct":false,"explanation":"Not exactly","type":"Fixnum"}},"points":1,"order":true,"question_comment":""},"question-10":{"question_text":"\n      When x = 2, the solution of $\\sqrt{3x+3}+(1+x)^2$ is:\n      ----\n    ","answers":{"qfi11-1":{"answer_text":12,"correct":true,"explanation":null,"type":"Fixnum"},"qfi11-2":{"answer_text":11,"correct":false,"explanation":"Try again!","type":"Fixnum"}},"points":1,"order":true,"question_comment":""},"question-11":{"question_text":"What is the largest US state?","answers":{"qmc12-1":{"answer_text":"Alaska","correct":true,"explanation":null},"qmc12-2":{"answer_text":"Texas","correct":false,"explanation":"That's pretty big, but think colder."},"qmc12-3":{"answer_text":"Hawaii","correct":false,"explanation":"Not big enough."}},"points":1,"question_comment":""},"question-12":{"question_text":"Which are American political parties?","answers":{"qsm13-1":{"answer_text":"Democrats","correct":true,"explanation":null},"qsm13-2":{"answer_text":"Republicans","correct":true,"explanation":null},"qsm13-3":{"answer_text":"Greens","correct":true,"explanation":"Yes, they're a party!"},"qsm13-4":{"answer_text":"Tories","correct":false,"explanation":"They're British"},"qsm13-5":{"answer_text":"Social Democrats","correct":false,"explanation":""}},"points":1,"question_comment":""},"question-13":{"question_text":"True or False: The earth is flat.","answers":{"qmc14-1":{"answer_text":"True","correct":false,"explanation":"No, just looks that way"},"qmc14-2":{"answer_text":"False","correct":true,"explanation":null}},"points":1,"question_comment":""},"question-14":{"question_text":"What does the following code do:\n    <pre>\n    puts \"Hello world!\"\n    </pre>\n    ","answers":{"qmc15-1":{"answer_text":"Throws an exception","correct":false,"explanation":"Don't be an idiot."},"qmc15-2":{"answer_text":"Prints a friendly message","correct":true,"explanation":null}},"points":1,"question_comment":""}};
      timestamp = 1398368316
      timestamp = timestamp.toString();
      language = 'es';
      totalPoints = 16;
      userPoints = 0;
      
      function findCorrectAnswer(idQuestion, questionType) {
        correctIds = [];
        for (id in data[idQuestion]['answers']) {
          if(data[idQuestion]['answers'][id.toString()]['correct'] == true)
            if (questionType == 0)
              return id.toString();
            else {
              correctIds.push(id.toString());
            } 
        }
        return correctIds;
      }
      
      function checkSelectMultiple(x, checkedIds, correctIds) {
        results = [];
        
        $.each(checkedIds, function(index, value){
          if (correctIds.indexOf(value) == -1) {
            results.push(false);
            printResults(value, 0, data[x.toString()]['answers'][value]['explanation'], 0);
          }
          else {
            results.push(true);
            printResults(value, 1, data[x.toString()]['answers'][value]['explanation'], 0);
          }
        });
        
        nCorrects = 0;
        nIncorrects = 0;
        $.each(results, function(index, value){
          if (value == true)
            nCorrects += 1;
          else
            nIncorrects += 1;
        });
        
        userPoints += calculateMark(data[x.toString()], x.toString(), null, 3, nCorrects, nIncorrects);
      }
      
      function printResults(id, type, explanation, typeQuestion) {
        if (typeQuestion == 0) {                                        // MultipleChoice and SelectMultiple
          $("br[class=" + id + "br" + "]").detach();
          if (type == 1) {
            if ((explanation == "") || (explanation == null))
              $("div[id ~= " + id + "r" + "]").html("<strong class=correct> " + i18n[language]['questions']['correct'] + "</strong></br>");
            else
              $("div[id ~= " + id + "r" + "]").html("<strong class=correct> " + i18n[language]['questions']['correct'] + " - " + explanation + "</strong></br>");
          }
          else {
            if ((explanation == "") || (explanation == null))
              $("div[id ~= " + id + "r" + "]").html("<strong class=incorrect> " + i18n[language]['questions']['incorrect'] + "</strong></br>");
            else
              $("div[id ~= " + id + "r" + "]").html("<strong class=incorrect> " + i18n[language]['questions']['incorrect'] + " - " + explanation + "</strong></br>");
          }
        }
        else {          // FillIn
          for (r in id) {
            input = $("#" + r.toString());
            if (id[r] == true) {
              input.attr('class', input.attr('class') + ' correct');
            }
            else { 
              if ((id[r] == false) || (id[r] != "n/a")) {
                input.attr('class', input.attr('class') + ' incorrect');
              }
            }
            
            if ((id[r] != true) && (id[r] != false) && (id[r] != "n/a")) {
              if (explanation[id[r].toString()] != null)
                $("div[id ~= " + r.toString() + "r" + "]").html(" <div class=explanation>" + explanation[id[r].toString()] + "</div>");
            }
            else {
              if (explanation[r] != null)
                $("div[id ~= " + r + "r" + "]").html(" <div class=explanation>" + explanation[r] + "</div>");
            }
          }
        }
      }
      
      function calculateMark(question, id, result, typeQuestion, numberCorrects, numberIncorrects) {
        stringPoints = i18n[language]['questions']['points'];
        if (typeQuestion == 2) {
          if (result) {
            $("#" + id).append("<strong class=mark> " + question['points'].toFixed(2) + "/" + question['points'].toFixed(2) + " " + stringPoints + "</strong></br></br>");
            
            return parseFloat(question['points']);
          }
          else {
            $("#" + id).append("<strong class=mark> 0.00/" + question['points'].toFixed(2) + " " + stringPoints + "</strong></br></br>");
            
            return parseFloat(0);
          }
        }
        else if (typeQuestion == 1) {
          size = 0;
          for (y in question['answers'])
            if (question['answers'][y]['correct'] == true)
              size += 1;
              
          pointsUser = ((question['points'] / size) * numberCorrects).toFixed(2);
          $("#" + id).append("<strong class=mark> " + pointsUser + "/" + question['points'].toFixed(2) + " " + stringPoints + "</strong></br></br>");
         
          return parseFloat(pointsUser);
        }
        else {
          totalCorrects = 0;
          for (y in question['answers']) {
            if (question['answers'][y]['correct'] == true)
              totalCorrects += 1;
          }
          
          correctAnswerPoints = question['points'] / totalCorrects;
          penalty = correctAnswerPoints * numberIncorrects;
          mark = (correctAnswerPoints * numberCorrects) - penalty;
          
          if (mark < 0)
            mark = 0;
            
          $("#" + id).append("<strong class=mark> " + mark.toFixed(2) + "/" + question['points'].toFixed(2) + " " + stringPoints + "</strong></br></br>");        
          
          return parseFloat(mark);
        }
      }
      
      function checkFillin(correctAnswers, userAnswers, distractorAnswers, typeCorrection) {
        correction = {};
        checkedAnswers = {};
        
        if (typeCorrection == 0) {          // Order doesn't matter
          for (u in userAnswers) {
            if (userAnswers[u] != undefined) {    // No empty field
              matchedCorrect = false;
              for (y in correctAnswers) {
                if (checkAnswers[u] == undefined) {
                  if ((typeof(correctAnswers[y]) == "string") || (typeof(correctAnswers[y]) == "number")) {    // Answer is a String or a Number
                    if (userAnswers[u] == correctAnswers[y]) {
                      correction[u] = true;
                      checkedAnswers[u] = userAnswers[u];
                      matchedCorrect = true;
                      break;
                    }
                  }
                  else {  // Answer is a Regexp
                    if (XRegExp.exec(userAnswers[u], correctAnswers[y])) {
                      correction[u] = true;
                      checkedAnswers[u] = userAnswers[u];
                      matchedCorrect = true;
                      break;
                    }
                  }
                }
              }
              if (!matchedCorrect)
                correction[u] = false;
            }
            else
              correction[u] = "n/a";
          }
        }
        else {                            // Order matters
          for (u in userAnswers) {
            if (userAnswers[u] != undefined) {
              if ((typeof(correctAnswers[u]) == "string") || (typeof(correctAnswers[u]) == "number")) {
                if (userAnswers[u] == correctAnswers[u])
                  correction[u] = true;
                else
                  correction[u] = false;
              }
              else {
                if (XRegExp.exec(userAnswers[u], correctAnswers[u]))
                  correction[u] = true;
                else
                  correction[u] = false;
              }
            }
            else
              correction[u] = "n/a";
          }
        }
        
        if (Object.keys(userAnswers).length == 1) {
          for (u in userAnswers) {
            if (correction[u] == false) {
              for (y in distractorAnswers) {
                if ((typeof(distractorAnswers[y]) == "string") || (typeof(distractorAnswers[y]) == "number")) {
                  if (userAnswers[u] == distractorAnswers[y])
                    correction[u] = y.toString();
                }
                else {
                  if (XRegExp.exec(userAnswers[u], distractorAnswers[y]))
                    correction[u] = y.toString();
                }
              }
            }
          }
        }
        return correction;
      }
      
      function checkAnswer(x) {
        
        if ($("#" + x.toString() + " strong").length == 0) {
          correct = false;
          answers = $("#" + x.toString() + " input");
          
          if ((answers.attr('class').match("fillin")) || (answers.attr('class').match("dragdrop"))) {
            correctAnswers = {};
            distractorAnswers = {};
            explanation = {};
            stringAnswer = false;
            flag_js = false;
            
            for (ans in data[x.toString()]['answers']) {
              if (data[x.toString()]['answers'][ans]['correct'] == true) {
                if (data[x.toString()]['answers'][ans]['type'] == "Regexp") {
                  string = data[x.toString()]['answers'][ans]['answer_text'].split('/');
                  regexp = string[1];
                  options = string[2];
                  correctAnswers[ans.toString()] = XRegExp(regexp, options);
                }
                else if (data[x.toString()]['answers'][ans]['type'] == "JS") {
                  flag_js = true;
                }
                else { // String or Number
                  correctAnswers[ans.toString()] = data[x.toString()]['answers'][ans]['answer_text'];
                  stringAnswer = true;
                }
              }
              else {
                if (data[x.toString()]['answers'][ans]['type'] == "Regexp") {
                  string = data[x.toString()]['answers'][ans]['answer_text'].split('/');
                  regexp = string[1];
                  options = string[2];
                  distractorAnswers[ans.toString()] = XRegExp(regexp, options);
                }
                else if (data[x.toString()]['answers'][ans]['type'] == "JS") {
                  //
                }
                else {// String or Number
                  distractorAnswers[ans.toString()] = data[x.toString()]['answers'][ans]['answer_text'];
                  stringAnswer = true;
                }
              }
              explanation[ans] = data[x.toString()]['answers'][ans]['explanation'];
            }
            
            userAnswers = {};
            for (i = 0; i < answers.length; i++) {
              if (answers[i].value == '')
                userAnswers[answers[i].id.toString()] = undefined;
              else
                if (stringAnswer)
                  userAnswers[answers[i].id.toString()] = answers[i].value.toLowerCase();
                else
                  userAnswers[answers[i].id.toString()] = answers[i].value;
            }
            
            if (flag_js == false) {
              if (data[x.toString()]['order'] == false)
                results = checkFillin(correctAnswers, userAnswers, distractorAnswers, 0);
              else
                results = checkFillin(correctAnswers, userAnswers, distractorAnswers, 1);
              
              allEmpty = true;
              nCorrects = 0;
              
              for (r in results) {
                if (results[r] == true)
                  nCorrects += 1;
                if (results[r] != "n/a")
                  allEmpty = false;
              }
              
              if (!allEmpty) {
                printResults(results, null, explanation, 1);
                userPoints += calculateMark(data[x.toString()], x.toString(), null, 1, nCorrects, null);
              }
            }
            else {
              nQuestion = parseInt(x.toString().split('-')[1]) + 1;
              id_answer_js = 'qfi' + nQuestion.toString() + '-1';
              result_function = eval(data[x.toString()]['answers'][id_answer_js]['answer_text']);
              
              values = [];
              ids = {};
              $.each(userAnswers, function(k,v) {
                ids[k] = false;
                values.push(eval(v));
              });
              
              result = result_function.apply(this, values);     // Execution of the function
              
              if (result) {
                $.each(ids, function(k,v) {
                  ids[k] = true;
                });
              }
              
              printResults(ids, null, explanation, 1);
              userPoints += calculateMark(data[x.toString()], x.toString(), result, 2, null, null);
            }
          }
          
          else if (answers.attr('class') == "select") {
            idCorrectAnswer = findCorrectAnswer(x.toString(), 0);
            
            if ($("#" + x.toString() + " :checked").size() != 0) {
              if ($("#" + x.toString() + " :checked").attr('id') == idCorrectAnswer) {
                printResults($("#" + x.toString() + " :checked").attr('id'), 1, "", 0);
                correct = true;
              }
              else {
                id = $("#" + x.toString() + " :checked").attr('id');
                printResults(id, 0, data[x.toString()]['answers'][id]['explanation'], 0);
              }
              userPoints += calculateMark(data[x.toString()], x.toString(), correct, 2, null, null);
            }
          }
          
          else {
            if ($("#" + x.toString() + " :checked").size() != 0) {
              answers = $("#" + x.toString() + " :checked");
              checkedIds = [];
              
              $.each(answers, function(index, value){
                checkedIds.push(value['id']);
              });
              
              correctIds = [];
              correctIds = findCorrectAnswer(x.toString(), 1);
              checkSelectMultiple(x, checkedIds, correctIds);
            }
          }
        }
      }
      
      function checkAnswers() {
        for (x in data) {
          checkAnswer(x);
        }
      }
      
      function storeAnswers() {
        if(typeof(Storage) !== undefined) {
          tmp = {}
          
          inputText = $('input:text').filter(function() { return $(this).val() != ""; });
          for (i = 0; i < inputText.length; i++) {
            idAnswer = inputText[i].id;
            tmp[idAnswer] = inputText[i].value;
          }
          
          inputRadioCheckBox = $('input:checked');
          for (i = 0; i < inputRadioCheckBox.length; i++) {
            idAnswer = inputRadioCheckBox[i].id;
            nquestion = parseInt(idAnswer.split('-')[0].substr(3)) - 1;
            tmp[idAnswer] = data["question-" + nquestion.toString()]['answers'][idAnswer]['answer_text'];
          }
          localStorage.setItem(timestamp, JSON.stringify(tmp));
        }
        else {
          alert(i18n[language]['alerts']['noStorage']);
        }
      }
      
      function loadAnswers() {
        if ((localStorage.length != 0) && (localStorage[timestamp] !== undefined)) {
          tmp = JSON.parse(localStorage[timestamp]);
          for (x in tmp) {
            if ((x.match(/qfi/)) || (x.match(/qdd/)))
              $("#" + x.toString()).val(tmp[x.toString()]);
            else
              $("#" + x.toString()).attr('checked', 'checked');
          }
        }
      }
      
      function deleteAnswers(all) {
        if (all) {
          localStorage.clear();
          alert(i18n[language]['alerts']['storage']);
        }
        else {
          localStorage.removeItem(timestamp);
          alert(i18n[language]['alerts']['answers']);
        }
      }
      
      function showTotalScore() {
        $("#score").html(i18n[language]['questions']['score'] + ": " + userPoints.toFixed(2) + "/" + totalPoints.toFixed(2) + " " + i18n[language]['questions']['points'])
      }
      
      function reload() {
        window.location.reload();
      }
      
      function changeButton(button, numQuestion) {
        if (button.attr('class').match('success')) {
          button.attr('class', button.attr('class').replace('success', 'danger'));
          button.html(i18n[language]['buttons']['hide']);
          showOrHideAnswer(numQuestion, 1);
        }
        else if (button.attr('class').match('danger')){
          button.attr('class', button.attr('class').replace('danger', 'success'));
          button.html(i18n[language]['buttons']['show']);
          showOrHideAnswer(numQuestion, 0);
        }
      }
      
      function showOrHideAnswer(numQuestion, flag) {
        answers = data['question-' + numQuestion.toString()]['answers'];
        typeQuestion = Object.keys(answers)[0].split('-')[0].slice(0, 3);
        numQuestion = (++numQuestion).toString();
        
        if (typeQuestion.match(/^qfi$/)) {
          inputs = $("input[id^=qfi" + numQuestion + "-");
          
          $.each(inputs, function(index, value) {
            if (flag == 1)
              $("input[id=" + value.id).val(answers[value.id]['answer_text']);
            else
              $("input[id=" + value.id).val('');
          });
        }
        else if (typeQuestion.match(/^qmc$/)){
          inputs = $("input[id^=qmc" + numQuestion + "-");
          correct = '';
          
          $.each(answers, function(key, value) {
            if (value['correct'] == true)
              correct = key;
          })
          
          if (flag == 1)
            $("input[id=" + correct).prop('checked', true);
          else
            $("input[id=" + correct).prop('checked', false);
        }
        else {
          inputs = $("input[id^=qsm" + numQuestion + "-");
          corrects = [];
          $.each(answers, function(key, value) {
            if (answers[key]['correct'] == true)
              corrects.push(key);
          }); 
          
          $.each(corrects, function(index, value) {
            if (flag == 1)
              $("input[id=" + value).prop('checked', true);
            else
              $("input[id=" + value).prop('checked', false);
          });
        }
      }
      
      $("#submit").click(function() {
        checkAnswers();
        filledAllQuiz = true;
        
        for (x in data) {
          if ($("#" + x.toString() + " strong").length == 0)
            filledAllQuiz = false; 
        }
        if (filledAllQuiz)
          $("#submit").detach();
        
        storeAnswers();
        showTotalScore();
      });

      $("#reset").click(function() {
        reload();
      });
      
      $("#deleteAnswers").click(function() {
        deleteAnswers(false);
        reload();
      });
      
      $("#deleteStorage").click(function() {
        deleteAnswers(true);
        reload();
      });
      
      $("button[id^=show-answer-q-").click(function() {
        numQuestion = parseInt($(this).attr('id').split('-')[3]);
        changeButton($(this), numQuestion);
      });
      
      $("button[id^=q-").click(function() {
        nQuestion = $(this).attr('id').split('-')[1];
        checkAnswer('question-' + nQuestion);
        storeAnswers();
        showTotalScore();
      });
      
      $(document).ready(function() {
        loadAnswers();
      });
</script>
    <!-- Any JavaScript included by the user -->
    
    <!-- Latest compiled and minified JavaScript for Bootstrap -->
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <!-- -->
  </body>
</html>
